<%- if user_signed_in? -%>
  <%- unless @bookmark.blank? -%>
    <!-- bookmarked_by_me -->
    <%- form_for(:bookmark, :url => user_bookmark_path(current_user.username, @bookmark, :mode => 'tag_edit'), :html => { :method => :put }) do |f| -%>
      <div>
        <%= f.text_field :tag_list, :value => @bookmark.tag_counts.collect(&:name).join(' '), :class => 'editable_text_field' -%>
        <%= submit_tag t('page.update') -%>
        (<%= link_to_remote t('page.cancel'), :update => 'tag_list', :url => {:controller => 'manifestations', :action => 'show', :id => @manifestation.id, :mode => 'tag_list'}, :method => :get -%>)
        <br />
        <%= t('tag.use_space_as_delimiter') -%>
      </div>
    <%- end -%>
    <%= javascript_tag("$('#bookmark_tag_list').focus()") -%>
  <%- else -%>
    <!-- bookmarked_by_other_patron_or_not_bookmarked -->
    <%- form_for(:bookmark, :url => user_bookmarks_path(current_user.username, :mode => 'tag_edit'), :html => { :method => :post }) do |f| -%>
      <div>
        <%= f.text_field :tag_list, :class => 'editable_text_field' -%>
        <%= f.hidden_field :title, :value => h(@manifestation.original_title) -%>
        <%= f.hidden_field :url, :value => manifestation_url(@manifestation) -%>
        <%= submit_tag t('page.create') -%>
        <!--
        <%= link_to_remote image_tag('/icons/cancel.png', :alt => t('page.cancel')), :update => 'tag_list', :url => {:controller => 'manifestations', :action => 'show', :id => @manifestation.id, :mode => 'tag_list'}, :method => :get -%>
        -->
        <%= link_to_remote t('page.cancel'), :update => 'tag_list', :url => {:controller => 'manifestations', :action => 'show', :id => @manifestation.id, :mode => 'tag_list'}, :method => :get -%>
        <br />
        <%= t('tag.use_space_as_delimiter') -%>
      </div>
    <%- end -%>
    <%= javascript_tag("$('#bookmark_tag_list').focus()") -%>
  <%- end -%>
<%- end -%>
