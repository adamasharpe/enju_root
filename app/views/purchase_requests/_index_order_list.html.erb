<div id="submenu">
  <ul>
    <li><%= link_to t('activerecord.models.order'), edit_order_list_path(@order_list, :mode => 'order') -%></li>
    <li><%= link_to t('purchase_request.all_request'), purchase_requests_path -%></li>
    <li><%= t('order_list.total_price') -%>: <%=h @order_list.total_price -%></li>
  </ul>
</div>

<div id="content_detail">
  <h1><%= t('page.listing', :model => t('activerecord.models.purchase_request')) -%>: <%=h @order_list.title -%></h1>
  <p><%= t('activerecord.attributes.order_lists.ordered_at') -%> <%=h @order_list.ordered_at -%></p>

<p>
  <%= link_to (image_tag 'feed-icon-14x14.png', :size => '14x14', :alt => t('page.feed'), :border => 0), :format => :rss -%>
  (<%= link_to ('RSS'), formatted_purchase_requests_path(:rss) -%>)
  (<%= link_to ('CSV'), formatted_purchase_requests_path(:csv, :lang => 'ja') -%>)

  <%= t('page.bookmarklet') -%>:
  <a href="javascript:window.location.href='<%=h new_user_purchase_request_url(current_user.login) -%>?url='+encodeURIComponent(location.href);"><%= t('purchase_request.add_to_purchase_request') -%></a>
</p>

<table id="index">
  <tr>
    <th><%= t('activerecord.attributes.purchase_request.title') -%></th>
    <th><%= t('activerecord.attributes.purchase_request.price') -%></th>
  </tr>

  <%- @purchase_requests.each_with_index do |purchase_request, i| -%>
    <tr class="line<%= cycle("0", "1") -%>">
      <td>
        <%= link_to h(purchase_request.title), purchase_request -%>
        <br />
        <%=h purchase_request.author -%>
        <%=h purchase_request.publisher -%>
        <%=h purchase_request.pubdate -%>
      </td>
      <td><%=h purchase_request.price -%></td>
      <td><%= link_to t('page.edit'), edit_user_purchase_request_path(purchase_request.user.login, purchase_request) -%></td>
      <td>
        <%- if_authorized?(:destroy, purchase_request) do -%>
          <%- if params[:mode] == "add" -%>
            <%= link_to t('page.add'), new_order_list_purchase_request_path(@order_list, :purchase_request_id => purchase_request.id, :mode => 'add') -%>
          <%- else -%>
            <%- order = @order_list.orders.find_by_purchase_request_id(purchase_request.id) -%>
            <%= link_to t('page.destroy'), order_list_order_path(@order_list, order), :confirm => t('page.are_you_sure'), :method => :delete -%>
          <%- end -%>
        <%- end -%>
      </td>
    </tr>
  <%- end -%>
</table>

<%= will_paginate(@purchase_requests, :previous_label => "&#171; " + t('page.previous'), :next_label => "&#187; " + t('page.next')) -%>

</div>
