<div id="content_detail">
<h1 class="title"><%= t('page.listing', :model => t('activerecord.models.event')) -%></h1>
<div id="content_list">

<%- if @library -%>
  <h2><%= link_to h(@library.display_name.localize), library_path(@library.name) -%></h2>
<%- else -%>
  <h2><%= t('event.all_libraries') -%></h2>
<%- end -%>

<%- form_for :events, :url => events_path, :html => {:method => 'get'} do -%>
  <p>
    <%= t('page.search_term') -%>: <%= text_field_tag 'query', h(@query), {:id => 'search_form_top', :class => 'search_form'} -%>
    <%= submit_tag t('page.search') -%>
  </p>
  <%= javascript_tag("$('search_form_top').focus()") -%>
<%- end -%>

<p>
  <%- case params[:mode]
      when 'upcoming' -%>
    <%= link_to t('event.all'), params.merge(:mode => nil) -%>
    <strong><%= t('event.upcoming') -%></strong>
    <%= link_to t('event.past'), params.merge(:mode => 'past') -%>
  <%- when 'past' -%>
    <%= link_to t('event.all'), params.merge(:mode => nil) -%>
    <%= link_to t('event.upcoming'), params.merge(:mode => 'upcoming') -%>
    <strong><%= t('event.past') -%></strong>
  <%- else -%>
    <strong><%= t('event.all') -%></strong>
    <%= link_to t('event.upcoming'), params.merge(:mode => 'upcoming') -%>
    <%= link_to t('event.past'), params.merge(:mode => 'past') -%>
  <%- end -%>
</p>

<table class="index">
  <tr>
    <th><%= t('activerecord.models.event_category') -%></th>
    <th><%= t('activerecord.attributes.event.title') -%></th>
    <th><%= t('activerecord.models.library') -%></th>
    <th><%= t('page.date') -%></th>
  </tr>

<%- @events.each_with_index do |event, i| -%>
  <tr class="line<%= cycle("0", "1") -%>">
    <td><%= event.event_category.display_name.localize -%></td>
    <td><%= link_to h(event.title.localize), event -%></td>
    <td><%= link_to h(event.library.display_name.localize), library_path(event.library.name) -%></td>
    <td>
      <%= l(event.start_at, :format => :short) -%>
      -
      <%= l(event.end_at, :format => :short) -%>
    </td>
    <%- if logged_in? -%>
      <%- if current_user.has_role?('Librarian') -%>
        <td><%= link_to t('page.edit'), edit_event_path(event) -%></td>
        <td><%= link_to t('page.destroy'), event, :confirm => t('page.are_you_sure'), :method => :delete -%></td>
      <%- end -%>
    <%- end -%>
  </tr>
<%- end -%>
</table>

<%= will_paginate(@events) -%>
</div>
</div>

<div id="submenu">
  <ul>
    <li><%= link_to t('page.calendar'), '/calendar' -%></li>
  </ul>
  <ul>
    <%- if logged_in? -%>
      <%- if current_user.has_role?('Librarian') -%>
        <%- if @library -%>
          <li><%= link_to t('page.new', :model => t('activerecord.models.event')), new_library_event_path(@library.name) -%></li>
        <%- else -%>
          <li><%= link_to t('page.new', :model => t('activerecord.models.event')), new_event_path(:date => params[:date]) -%></li>
        <%- end -%>
        <li><%= link_to t('event.import_event'), event_import_files_path -%></li>
      <%- end -%>
    <%- end -%>
  </ul>
  <ul>
    <%- Library.all.each do |library| -%>
      <li><%= link_to h(library.display_name.localize), library_events_path(library.name) -%></li>
    <%- end -%>
  </ul>
  <p>
    <%- if @library -%>
      <%= link_to (image_tag 'feed-icon-14x14.png', :size => '14x14', :alt => t('page.feed'), :border => 0), library_events_path(@library.name, :format => :rss) -%>
      (<%= link_to 'RSS', library_events_path(@library.name, :format => :rss) -%>)
      (<%= link_to 'CSV', library_events_path(@library.name, :format => :csv, :locale => @locale) -%>)
    <%- else -%>
      <%= link_to (image_tag 'feed-icon-14x14.png', :size => '14x14', :alt => t('page.feed'), :border => 0), events_path(:format => :rss) -%>
      (<%= link_to 'RSS', events_path(:format => :rss) -%>)
      (<%= link_to 'CSV', events_path(:format => :csv, :locale => @locale) -%>)
    <%- end -%>
  </p>
  <%= render :partial => 'page/login' unless logged_in? -%>
</div>
