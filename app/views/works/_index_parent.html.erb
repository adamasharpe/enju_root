<div id="submenu">
  <ul>
    <%- if_authorized?(:new, Work) do -%>
      <li><%= link_to t('page.new', :model => t('activerecord.models.work')), new_work_path -%></li>
    <%- end -%>
  </ul>
</div>
                      
<div id="content_detail">
<%- form_for :works, :url => works_path, :html => {:method => 'get'} do -%>
  <p>
    <%= t('page.search_term') -%>: <%= text_field_tag 'query', h(@query) -%>
    <%= hidden_field_tag 'parent_id', @parent.id if @parent -%>
    <%= hidden_field_tag 'work_id', @work.id if @work -%>
    <%= submit_tag t('page.search') -%>
    <%- if_authorized?(:destroy, @work) do -%>
      <%- if params[:mode] == 'add' -%>
        <%= radio_button_tag 'mode', 'show' -%> <%= t('page.show') -%>
        <%= radio_button_tag 'mode', 'add', :checked => true -%> <%= t('page.add') -%>
      <%- else -%>
        <%= radio_button_tag 'mode', 'show', :checked => true -%> <%= t('page.show') -%>
        <%= radio_button_tag 'mode', 'add' -%> <%= t('page.add') -%>
      <%- end -%>
    <%- end -%>
    <%= link_to t('page.back_to_index'), patron_works_path(@patron) -%>
  </p>
<%- end -%>

<table id="index">
  <tr>
    <th><%= t('page.title') -%></th>
    <th><%= t('activerecord.attributes.work.context') -%></th>
    <th></th>
  </tr>
  <%- for work in @works -%>
    <tr>
      <td>
        <%= link_to h(work.original_title), work_path(work, :parent_id => @parent.id) -%>
        <br />
        <%- work.patrons.each do |patron| -%>
          <%= link_to h(patron.full_name), patron -%>
        <%- end -%>
      </td>
      <td><%=h work.context -%></td>
      <td>
        <%- if_authorized?(:destroy, work) do -%>
          <%- if params[:mode] == "add " -%>
            <%= link_to t('page.add'), edit_work_path(work, :parent_id => @parent.id) -%>
          <%- else -%>
            <%= link_to t('page.destroy'), work_path(work, :parent_id => nil), :confirm => t('page.are_you_sure'), :method => :put -%>
          <%- end -%>
        <%- end -%>
      </td>
    </tr>
  <%- end -%>
</table>

<%= will_paginate(@works, :previous_label => "&#171; " + t('page.previous'), :next_label => "&#187; " + t('page.next')) -%>
</div>
